<html>
<head>

	<title>Dashboard</title>
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110932262-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110932262-1');
</script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- Bootstrap Js CDN -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<!-- Funktion zum Auslesen der Cookie Values -->
	<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
	<!-- Scrollbar Custom CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
	<!-- AJAX URL Helper -->
	<script type="text/javascript" src="js/handleAJAX.js"></script>
	<!-- Stylessheets -->
	<link rel="stylesheet" type="text/css" href="css/dashboardStyles.css">
	<script type="text/javascript" src="/fa17g17/js/searchLogic.js"></script>


    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
	<!-- Checker -->
	<script type="text/javascript" src="js/inputChecker.js"></script>
</head>
<style>
// ---------- navbar Styles ----------

// ---------- navbar Styles End ----------

.backgroundContainer{
	background-image: url("./img/background.jpg") !important;
	background-image-size: auto !important;
}

.loggedInDropdown {
	background: transparent;
	color: white;
	border-color: transparent;
}

.loggedInDropdown:hover {
	background: transparent;
	color: white;
	border-color: transparent;
}

.loggedInDropdown:focus {
	background: #333;
	color: white;
	border-color: transparent;
}

.loggedInDropdown:active {
	background: #333;
	color: white;
	border-color: transparent;
}


</style>
<body style="
	background-image: url(./img/background.jpeg);
	background-image-size: 100%;
">
<div>
	<nav class="navbar navbar-inverse" role="navigation" style="padding-left:80px;">
			<ul class="nav navbar-nav">
			<li><a href="/fa17g17">Home<span class="sr-only">(current)</span></a></li>
			<li>
			<form id="searchbar_for_estates" class="navbar-form" role="search">
				<div class="input-group add-on" style="display: flex; flex: 1 1 auto;">
				<select id = "nav_angebot_art" class="form-control">
					<option>Buy</option>
					<option>Rent</option>
				</select>
				<select id = "nav_ort" class="form-control">
					<option>Fulda</option>
					<option>Hünfeld</option>
					<option>Eichenzell</option>
					<option>Neuhof</option>
					<option>Petersberg</option>
				</select>
				<select id = "nav_objektart" class="form-control">
					<option>Estate</option>
					<option>House</option>
					<option>Apartment</option>
					<option>Villa/Townhouse</option>
				</select>
				<div class="col-md-2"><input id = "nav_qm" type="text" class="form-control" placeholder="Square meters..."></div>
				<div class="col-md-2"><input id = "nav_preis" type="text" class="form-control" placeholder="Max Price..."></div>
				<select id = "nav_zimmeranzahl" class="form-control">
					<option value="0">-</option>
					<option value="1">ab 1 Zimmer</option>
					<option value="2">ab 2 Zimmer</option>
					<option value="3">ab 3 Zimmer</option>
					<option value="4">ab 4 Zimmer</option>
					<option value="5">ab 5 Zimmer</option>
				</select>

				<div class="input-group-btn">
					<button id="nav_bt_search" class="btn btn-default" type="button"><i class="glyphicon glyphicon-search"></i></button>
				</div>
			 </div>
			</form>
			</li>
			<li id="logDropping">
					<a style="float: right;" href="/fa17g17/user/logout">Logout</a>
			</li><!-- if logged in -->
			<li id="nlogDropping" style="float: right;"><a href="/fa17g17/Login">Sign-In</a></li><!-- if logged out -->
		</ul>
	</nav>
</div>
<!-- Navbar left -->
<div class="wrapper backgroundContainer">

	<nav id="sidebar">
		<!-- Sidebar Header -->
		<div class="sidebar-header">
			<h3>Dashboard</h3>
			</div>
			<ul class="list-unstyled components">
				<li><a href="/fa17g17/Dashboard">User Settings</a></li>
				<li><a href="/fa17g17/Dashboard/Messages">Messages</a></li>

				<li><a href="/fa17g17/Dashboard/Favorits">Favorits</a></li>
				<li><a href="/fa17g17/Dashboard/Offers">Offers</a></li>
				<li><a href="/fa17g17/Dashboard/contacts">Contacts</a></li>
			</ul>
	</nav>

	<div id="content" style="flex: 1; padding-top: 5px;">
	<!-- Change User Credentials Formular -->
		<div class="wrapper-form">
			<form class="form-horizontal" role="form" style="color: white;">
                <h2>Account Info</h2>
                <div class="form-group">
                    <label for="email" class="col-sm-3 control-label">Email</label>
                    <div class="col-sm-9">
                        <input type="email" id="email" placeholder="alice.bob@provider.com" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label for="password" class="col-sm-3 control-label">Password</label>
                    <div class="col-sm-9">
                        <input type="password" id="password" placeholder="Password" class="form-control">
                    </div>
                </div>
				<div class="form-group">
                    <label for="password" class="col-sm-3 control-label">Password repeat</label>
                    <div class="col-sm-9">
                        <input type="password" id="passwordRepeat" placeholder="Password" class="form-control">
                    </div>
                </div>
                <div class="form-group">
					<div class="col-sm-9 col-sm-offset-3">
						<div class="btn-group btn-group-justified">
							<div class="btn-group">
								<button id="deleteButton" type="button" class="btn btn-danger">Delete Account</button>
							</div>
							<div class="btn-group">
								<button id="changeAccountButton" type="button" class="btn btn-primary">Change Account Details</button>
							</div>
						</div>
					</div>
                </div>
								<p id="errorStateAccount"></p>
    </form> <!-- /form -->
		<form class="form-horizontal" role="form" style="color: white;">
			<h2>Upgrade to Agent</h2>
			<div class="form-group">
				<label for="agency" class="col-sm-3 control-label">Agency</label>
				<div class="col-sm-9">
					<select id="agency" class="form-control">
						<option>SFStateHomes</option>
						<option>SJStateRealtors</option>
						<option>CSURealEstate</option>
					</select>
				</div>
			</div>
			<div class="form-group">
					<label for="agentID" class="col-sm-3 control-label">Agent ID</label>
					<div class="col-sm-9">
							<input type="text" id="agentID" placeholder="01-12345-67890" class="form-control">
					</div>
			</div>
			<div class="form-group">
				<div class="col-sm-9 col-sm-offset-3">
					<button id="changeRoleButton" type="button" class="btn btn-primary btn-block">Make me an estate agent</button>
				</div>
			</div>
		</form> <!-- /form -->
	</div>
	</div>
	<div id="content" style="flex: 1; padding-top: 5px;">
		<div class="wrapper-form">
				<form class="form-horizontal" role="form" style="color: white;">
					<h2>Contact Info</h2>
					<div class="form-group">
                    <label for="firstName" class="col-sm-3 control-label">First Name</label>
                    <div class="col-sm-9">
                        <input type="text" id="firstName" placeholder="Max" class="form-control" autofocus>
                    </div>
                </div>
				<div class="form-group">
                    <label for="lastName" class="col-sm-3 control-label">Last Name</label>
                    <div class="col-sm-9">
                        <input type="text" id="lastName" placeholder="Mustermann" class="form-control" autofocus>
                    </div>
                </div>
				<div class="form-group">
                    <label for="telephone" class="col-sm-3 control-label">Telephone</label>
                    <div class="col-sm-9">
                        <input type="tel" id="telephone" placeholder="+49 12345678900" class="form-control">
                    </div>
                </div>
					<div class="form-group">
						<label for="street" class="col-sm-3 control-label">Street</label>
						<div class="col-sm-9">
							<input type="text" id="street" class="form-control" placeholder="Street and Number">
						</div>
					</div>
					<div class="form-group">
						<label for="city" class="col-sm-3 control-label">City</label>
						<div class="col-sm-9">
							<input type="text" id="city" class="form-control" placeholder="City">
						</div>
					</div>
					<div class="form-group">
						<label for="postalcode" class="col-sm-3 control-label">Postalcode</label>
						<div class="col-sm-9">
							<input type="text" id="postalcode" class="form-control" placeholder="Postalcode">
						</div>
					</div>
					<div class="form-group">
						<label for="country" class="col-sm-3 control-label">Country</label>
						<div class="col-sm-9">
							<select id="country" class="form-control">
								<option>Germany</option>
								<option>USA</option>
								<option>Austria</option>
								<option>France</option>
								<option>Poland</option>
								<option>Sweden</option>
								<option>England</option>
								<option>Mexico</option>
							</select>
						</div>
					</div>
					<div class="form-group">
            <div class="col-sm-9 col-sm-offset-3">
            	<button id="changeContactButton" type="button" class="btn btn-primary btn-block">Change Contact Details</button>
          	</div>
          </div>
					<p id="errorStateContact"></p>
				</form>
		</div>
	</div>
</div>
<!-- Toggle Button für die Sidebar -->
<!--<div id="content">
	<button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn" style="
		color: white;
		background: linear-gradient(to bottom, #b5bdc8 0%,#828c95 36%,#28343b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
		border-color: black;
	">
		<span class="glyphicon glyphicon-th"></span></p>
	</button>
</div>-->
<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<!-- Bootstrap Js CDN -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- Custom Scroller Js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

<!-- Favorits -->

<!-- Messagingboard -->

<!-- Offers -->

<!-- Abschluss der Seite-->
<footer class="footer">
      <div class="container">
        <span class="text-muted"><a href="/fa17g17/about">About us</a>, Copyrights, Social Media</span>
      </div>
    </footer>
</body>
<script>
$(document).ready(function () {

	// Helper-Object: set url to sfsuse or localhost
	var ajaxURL = new AJAXSettings().getAJAXURL();

	//Prüfe, ob User bereits angemeldet
	var cookieArray = Cookies.get('UserID');
	var userObject = null;

	if(typeof(cookieArray) != "undefined") {
		userObject = JSON.parse(cookieArray.substring(2));
	}

	if(userObject != null){
		$("#logDropping").show();
		$("#nlogDropping").hide();
	} else {
		$("#logDropping").hide();
		$("#nlogDropping").show();
	}

    $("#sidebar").mCustomScrollbar({
         theme: "minimal"
    });

    $('#sidebarCollapse').on('click', function () {
        // open or close navbar
        $('#sidebar').toggleClass('active');
        // close dropdowns
        $('.collapse.in').toggleClass('in');
        // and also adjust aria-expanded attributes we use for the open/closed arrows
        // in our CSS
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
    });

	$('#deleteButton').click(function () {
		if (confirm('Are you sure you want to delete your account completely? This cannot be undone!!!')) {
			// console.log("Confirmed");
			$.ajax
			(
				{
					type		: "POST",
					url			: ajaxURL + "/fa17g17/user/delete",
					contentType	: 'application/json',
					data		: JSON.stringify
					(
						{
							"id":userObject.id
						}
					),
					success		: function (data)
					{
						console.log("SUCCESS-CB");
						if(data.deleted == "true") {
							window.location.href = "/fa17g17/";
						} else {
							alert("Could not successfully deleted your account!!!");
						}
					},
					error		: function (err)
					{
						console.log("ERROR-CB");
						console.log(err);
					}
				}
			).done
			(
				function ()
				{
					console.log("DONE-CB");
				}
			);
	 	}
	});

	$('#changeContactButton').click(function (){
		if($('#city').val() == "" || $('#postalcode').val() == "") {
			$('#city').css("border", "5px solid red");
			$('#postalcode').css("border", "5px solid red");
			alert("At a minimum you have to specify your city and postalcode. Be aware of this fact!!!");
		} else {
			// Check Inputs
			var valid = checkInputOnCharacters([
				$('#firstName').val(),
				$('#lastName').val(),
				$('#telephone').val(),
				$('#street').val(),
				$('#city').val(),
				$('#postalcode').val(),
				$('#country').val()
			]);
			if( valid == 1) {
				$.ajax
				(
					{
						type		: "POST",
						url			: ajaxURL + "/fa17g17/user/update/contactInfo",
						contentType	: 'application/json',
						data		: JSON.stringify
						(
							{
								"id":userObject.id,
								"firstname":$('#firstName').val(),
								"lastname":$('#lastName').val(),
								"telephone":$('#telephone').val(),
								"street":$('#street').val(),
								"city":$('#city').val(),
								"postalcode":$('#postalcode').val(),
								"country":$('#country').val()
							}
						),
						success		: function (data)
						{
							console.log("SUCCESS-CB");
							console.log(data);
							if(data.update == "true"){
								window.location.href = "/fa17g17/Dashboard";
								console.log(data);
							} else {
								$('#errorStateContact').val(data.message);
							}
						},
						error		: function (err)
						{
							console.log("ERROR-CB");
							console.log(err);
						}
					}
				).done
				(
					function ()
					{
						console.log("DONE-CB");
					}
				);
			} else {
				alert("invalid inputs");
			}
		}
	});

	$('#changeAccountButton').click(function (){
		if (($('#password').val() == $('#passwordRepeat').val())
			&& $('#password').val() != "" && $('#passwordRepeat').val() != ""){
			
			// Check Inputs
			var valid = checkInputOnCharacters([
				$('#email').val(),
				$('#password').val()
			]);
			if( valid == 1 ) {
				$.ajax
				(
					{
						type		: "POST",
						url			: ajaxURL + "/fa17g17/user/update/credentials",
						contentType	: 'application/json',
						data		: JSON.stringify
						(
							{
								"id":userObject.id,
								"mail":$('#email').val(),
								"password":$('#password').val()
							}
						),
						success		: function (data)
						{
							console.log("SUCCESS-CB");
							console.log(data);
							if(data.update == "true"){
								window.location.href = "/fa17g17/dashboard";
							} else {
								$('#errorStateAccount').val(data.message);
							}
						},
						error		: function (err)
						{
							console.log("ERROR-CB");
							console.log(err);
						}
					}
				).done
				(
					function ()
					{
						console.log("DONE-CB");
					}
				);
			} else {
				alert("invalid inputs");
			}
			
		} else {
			$('#password').css("border", "5px solid red");
			$('#passwordRepeat').css("border", "5px solid red");
			alert("Passwords do not match or not specified!!! Check this!!!");
		}
	});

	$('#changeRoleButton').click(function () {
		if($('#agentID').val() != ""){
			// console.log($('#agency').val());
			// console.log($('#agentID').val());
			
			// Check Inputs
			var valid = checkInputOnCharacters([
				$('#agency').val(),
				$('#agentID').val()
			]);
			if( valid == 1 ) {
							$.ajax
				(
					{
						type		: "POST",
						url			: ajaxURL + "/fa17g17/user/update/role",
						contentType	: 'application/json',
						data		: JSON.stringify
						(
							{
								"id":userObject.id,
								"agency":$('#agency').val(),
								"agentID":$('#agentID').val()
							}
						),
						success		: function (data)
						{
							console.log("SUCCESS-CB");
							console.log(data);
							if(data.update == "true"){
								window.location.href = "/fa17g17/dashboard";
							} else {
								alert("There went something wrong with your agent upgrade");
							}
						},
						error		: function (err)
						{
							console.log("ERROR-CB");
							console.log(err);
						}
					}
				).done
				(
					function ()
					{
						console.log("DONE-CB");
					}
				);
			} else {
				alert("invalid inputs");
			}
		}
	});

	function autoFillPersonals(){
		var cookieArray = Cookies.get('UserID');
		var userObject = null;

		if(typeof(cookieArray) != "undefined") {
			userObject = JSON.parse(cookieArray.substring(2));

			// Fire ajax
			$.ajax
			(
				{
					type		: "POST",
					url			: ajaxURL + "/fa17g17/user/profile",
					contentType	: 'application/json',
					data		: JSON.stringify
					(
						{
							"id":userObject.id
						}
					),
					success		: function (data)
					{
						console.log("SUCCESS-CB");
						if(data.success == "true"){
							console.log(data.data);
							$('#firstName').val(data.data.firstname);
							$("#lastName").val(data.data.lastname);
							$("#email").val(data.data.mail);
							$("#telephone").val(data.data.phone);
							$("#street").val(data.data.street);
							$("#city").val(data.data.city);
							$("#postalcode").val(data.data.postalcode);

							if(data.data.role == 3) {
								$('#agency').val(data.data.agency);
								$('#agentID').val(data.data.agentID);
								$("#changeRoleButton").text('Update Agent State');
							}
						} else {
							console.log("Cannot get user data from server");
						}
					},
					error		: function (err)
					{
						console.log("ERROR-CB");
						console.log(err);
					}
				}
			).done
			(
				function ()
				{
					console.log("DONE-CB");
				}
			);
		}
	}
	autoFillPersonals();
});
</script>
</html>
